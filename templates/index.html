<!DOCTYPE html>
<html>
<head>
    <title>Social Media Analyzer</title>
    <style>
        body { font-family: Arial; max-width: 900px; margin: auto; padding: 20px; }
        textarea { width: 100%; height: 120px; }
        .box { border: 1px solid #ccc; padding: 15px; margin-top: 20px; border-radius: 8px; }
        pre { white-space: pre-wrap; background:#f7f7f7; padding:10px; border-radius:6px;}
        button { padding:10px 18px; font-size:15px; }
        select { padding:6px; }
        .hint { color:#666; font-size:14px; margin-top:6px; }
    </style>
</head>
<body>

<h2>Social Media Content Analyzer</h2>
<p>Upload a post, image, or PDF and analyze public sentiment & engagement suggestions.</p>

<form id="form">
    <label><b>Enter Text</b></label><br>
    <textarea id="textInput" name="text" placeholder="Type a post here..."></textarea>

    <p id="inputHint" class="hint">
        You can either paste text OR upload a PDF.
    </p>

    <br><br>
    <label><b>Upload File (optional)</b></label><br>
    <input id="fileInput" type="file" name="file">

    <br><br>
    <label><b>Analyze opinions from:</b></label><br>
    <select name="time_range">
        <option value="day">Last 24 Hours</option>
        <option value="week">Last Week</option>
        <option value="month">Last Month</option>
        <option value="year">Last Year</option>
        <option value="all" selected>All Time</option>
    </select>

    <br><br>
    <button type="submit">Analyze</button>
</form>

<div id="loading" style="display:none;"><h3>Analyzing... please wait ‚è≥</h3></div>

<div id="result" class="box" style="display:none;">
    <h3>Extracted Text</h3>
    <pre id="text"></pre>

    <h3>Selected Time Range</h3>
    <pre id="range"></pre>

    <h3>Sentiment Comparison</h3>
    <pre id="sentiment"></pre>

    <h3>AI Feedback</h3>
    <pre id="feedback"></pre>
</div>

<script>

const textInput = document.getElementById("textInput");
const fileInput = document.getElementById("fileInput");
const hint = document.getElementById("inputHint");
const formEl = document.getElementById("form");

function updateInputState() {

    if (textInput.value.trim().length > 0) {
        fileInput.disabled = true;
        hint.innerText = "File upload disabled because text is present. Clear text to upload a PDF.";
    } 
    else if (fileInput.files.length > 0) {
        textInput.disabled = true;
        hint.innerText = "File selected. Text input will be ignored.";
    } 
    else {
        fileInput.disabled = false;
        textInput.disabled = false;
        hint.innerText = "You can either paste text OR upload a PDF.";
    }
}

textInput.addEventListener("input", () => {
    if (textInput.value.trim().length === 0) {
        fileInput.disabled = false;
    }
    updateInputState();
});

fileInput.addEventListener("change", () => {
    if (fileInput.files.length === 0) {
        textInput.disabled = false;
    }
    updateInputState();
});

formEl.addEventListener("submit", (e) => {
    if (!textInput.value.trim() && fileInput.files.length === 0) {
        alert("Please enter text OR upload a file.");
        e.preventDefault();
    }
});

document.getElementById("form").onsubmit = async (e) => {
    e.preventDefault();

    const form = new FormData(e.target);
    const range = form.get("time_range");

    document.getElementById("loading").style.display = "block";
    document.getElementById("result").style.display = "none";

    const res = await fetch("/analyze?time_range=" + range, {
        method: "POST",
        body: form
    });

    const data = await res.json();

    document.getElementById("loading").style.display = "none";
    document.getElementById("result").style.display = "block";

    document.getElementById("text").innerText = data.extracted_text;
    document.getElementById("range").innerText = range.toUpperCase();

    document.getElementById("sentiment").innerText =
        "User Sentiment:\n" + JSON.stringify(data.user_sentiment, null, 2) +
        "\n\nPublic Sentiment:\n" + JSON.stringify(data.public_sentiment, null, 2);

    document.getElementById("feedback").innerText =
        "Tone Comparison:\n" + data.analysis.tone_comparison +
        "\n\nTips:\n- " + data.analysis.tips.join("\n- ") +
        "\n\nImproved Post:\n" + data.analysis.rewritten_post;
};

updateInputState();

</script>

</body>
</html>
